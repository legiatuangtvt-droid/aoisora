<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task List - HQ System</title>    
    
    <!-- Static links are preferred over document.write to avoid parser blocking -->
    <link rel="icon" href="img/logo.png">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/hq-task-list.css">
    <script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script defer src="js/i18n.js"></script>
    <script defer src="js/hq-task-list.js"></script>
</head>
<body>
    <div class="container">
        <!-- Top bar, consistent with other pages -->
        <div class="home-screen">
            <button id="store-screen" data-i18n-key="go-to-store-screen">Go to Store screen</button>
            <h1 data-i18n-key="hq-system">HQ SYSTEM</h1>
        </div>

        <!-- Main navigation, consistent with other pages -->
        <div class="button-group button-row">
            <div class="button-row-buttons">
                <button id="go-to-hq-tasks" data-i18n-key="hq-tasks">HQ Tasks</button>
                <button id="go-to-task-list" class="selected" data-i18n-key="view-task-list">View Task List</button>
                <button id="go-to-create-task" data-i18n-key="assign-new-task">Assign New Task</button>
                <button id="go-to-store-list" data-i18n-key="manage-stores">Manage Stores</button>
                <button id="go-to-reports" data-i18n-key="view-reports">View Reports</button>
            </div>
        </div>
 
        <!-- Main content of the page -->
        <main>
            <div id="content-wrapper">
                <!-- Report Content (initially hidden, will be on the left in split view) -->
                <div id="report-content" class="content-pane" style="display: none;">
                    <!-- Loading overlay specific to the report section -->
                    <div id="loading-overlay">
                        <div class="loading-spinner"></div>
                        <div class="loading-text" data-i18n-key="loading-data">Loading data...</div>
                        <div class="progress-bar-container">
                            <div id="progress-bar" class="progress-bar"></div>
                        </div>
                        <div id="progress-text" class="progress-text">0%</div>
                    </div>

                    <h1 class="section-title" data-i18n-key="reports">Reports</h1>
                    <!-- Charts Section -->
                    <section class="charts-section">

                        <div class="chart-controls">
                            <button id="togglePie" class="chart-toggle red" data-i18n-key="show-progress-chart">Show Progress Chart</button>
                            <button id="toggleBar" class="chart-toggle red" data-i18n-key="show-weekly-stats-chart">Show Weekly Stats Chart</button>
                        </div>
                        <div class="charts-container">
                            <div class="chart-wrapper">
                                <canvas id="progressPieChart"></canvas>
                            </div>
                            <div class="chart-wrapper">
                                <canvas id="progressBarChart"></canvas>
                            </div>
                        </div>
                    </section>

                    <section class="report-section">
                        <h2 data-i18n-key="completion-rate-by-store">Completion Rate by Store</h2>
                        <div class="report-filters">
                            <select id="year-filter"></select>
                            <select id="quarter-filter">
                                <option value="all" data-i18n-key="all-quarters">All Quarters</option>
                                <option value="1" data-i18n-key="quarter-1">Quarter 1</option>
                                <option value="2" data-i18n-key="quarter-2">Quarter 2</option>
                                <option value="3" data-i18n-key="quarter-3">Quarter 3</option>
                                <option value="4" data-i18n-key="quarter-4">Quarter 4</option>
                            </select>
                            <select id="month-filter"></select>
                        </div>
                        <div class="chart-container">
                            <canvas id="taskCompletionChart"></canvas>
                        </div>
                        <div id="task-table-container" class="table-container">
                            <table id="task-table">
                                <thead>
                                    <tr></tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </section>
        
                    <section class="report-section">
                        <h2 data-i18n-key="task-stats-by-dept">Task Stats by Department</h2>
                        <div class="chart-container">
                            <canvas id="taskReviewBarChart"></canvas>
                        </div>
                        <div class="table-container">
                            <table id="task-table2">
                                <thead>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                </div>

                <!-- Task List Content -->
                <div id="task-list-content" class="content-pane">
                    <h1 class="section-title" data-i18n-key="view-task-list">Task List</h1>

                    <!-- Task List Section -->
                    <section class="task-list-section">
                        <div class="filters">
                            <button id="time-filter-toggle" class="chart-toggle green" data-i18n-key="this-week">This Week</button>
                            <input type="date" id="startDate" />
                            <input type="date" id="endDate" />
                            <input type="text" id="taskSearch" data-i18n-key="search-by-task-name" placeholder="Search by Task Name..." />
                            <button id="export-csv" data-i18n-key="export-csv">Export CSV</button>
                        </div>

                        <table id="main-task-list-table">
                            <thead>
                                <tr>
                                    <th data-i18n-key="no-short">No.</th>
                                    <th id="weekFilter" class="clickable" data-i18n-key="week" data-column="isoWeek">Week</th>
                                    <th id="respFilter" class="clickable" data-i18n-key="department" data-column="department_name">Department</th>
                                    <th class="clickable" data-i18n-key="task" data-column="task_name">Task</th>
                                    <th class="clickable" data-i18n-key="progress" data-column="progress">Progress</th>
                                    <th class="clickable" data-i18n-key="stores-unable" data-column="unable">Stores Unable</th>
                                    <th class="clickable" data-i18n-key="status" data-column="status_name">Status</th>
                                </tr>
                            </thead>
                            <tbody id="taskTableBody">
                                <!-- Rendered dynamically -->
                            </tbody>
                        </table>
                        <div id="pagination-container"></div>
                    </section>
                </div>
            </div>
        </main>
        <div id="filter-popup" class="filter-popup" style="display: none;"></div>
    </div>
</body>
</html>
