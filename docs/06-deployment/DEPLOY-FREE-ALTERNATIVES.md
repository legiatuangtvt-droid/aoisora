# Deploy OptiChain HOÃ€N TOÃ€N MIá»„N PHÃ

HÆ°á»›ng dáº«n deploy OptiChain WS & DWS vá»›i **$0 chi phÃ­** sá»­ dá»¥ng cÃ¡c dá»‹ch vá»¥ free tier.

## ğŸ“‹ Kiáº¿n trÃºc FREE Deployment

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Mobile Apps (iOS/Android)          â”‚
â”‚  Codemagic Free Tier                â”‚ â† 500 phÃºt build/thÃ¡ng FREE
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend - Vercel/Netlify          â”‚ â† HoÃ n toÃ n FREE
â”‚  Next.js Static                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend - Railway/Render           â”‚ â† FREE tier (cÃ³ giá»›i háº¡n)
â”‚  FastAPI + Python                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database - Supabase/Neon           â”‚ â† FREE PostgreSQL
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’° So sÃ¡nh cÃ¡c Options MIá»„N PHÃ

### Option 1: â­ KHUYÃŠN DÃ™NG (Dá»… nháº¥t)

| Component | Service | Free Tier | Giá»›i háº¡n |
|-----------|---------|-----------|----------|
| **Backend** | Railway.app | FREE | 500 giá»/thÃ¡ng, $5 credit |
| **Frontend** | Vercel | FREE | Unlimited, 100GB bandwidth |
| **Database** | Supabase | FREE | 500MB database, 2GB bandwidth |
| **Mobile** | Codemagic | FREE | 500 phÃºt build/thÃ¡ng |

**Tá»•ng chi phÃ­: $0/thÃ¡ng** âœ…

### Option 2: HoÃ n toÃ n miá»…n phÃ­ vÄ©nh viá»…n

| Component | Service | Free Tier | Giá»›i háº¡n |
|-----------|---------|-----------|----------|
| **Backend** | Render.com | FREE | Sleep sau 15 phÃºt khÃ´ng dÃ¹ng |
| **Frontend** | Netlify | FREE | 100GB bandwidth |
| **Database** | Neon | FREE | 0.5GB storage |
| **Mobile** | Codemagic | FREE | 500 phÃºt/thÃ¡ng |

**Tá»•ng chi phÃ­: $0/thÃ¡ng** âœ… (cÃ³ trade-offs)

### Option 3: Firebase (All-in-one)

| Component | Service | Free Tier |
|-----------|---------|-----------|
| **Backend** | Firebase Functions | FREE | 2M invocations/thÃ¡ng |
| **Frontend** | Firebase Hosting | FREE | 10GB storage, 360MB/day |
| **Database** | Firestore | FREE | 1GB storage, 50K reads/day |
| **Mobile** | Codemagic | FREE | 500 phÃºt/thÃ¡ng |

**Tá»•ng chi phÃ­: $0/thÃ¡ng** âœ…

---

## ğŸš€ Option 1: Railway + Vercel + Supabase (KHUYÃŠN DÃ™NG)

### âœ… Æ¯u Ä‘iá»ƒm:
- Setup nhanh nháº¥t (< 30 phÃºt)
- Deploy tá»« GitHub tá»± Ä‘á»™ng
- KhÃ´ng bá»‹ sleep (Railway free tier)
- Database PostgreSQL tháº­t (khÃ´ng pháº£i Firestore)
- URL Ä‘áº¹p, SSL miá»…n phÃ­

### âš ï¸ Giá»›i háº¡n:
- Railway: 500 giá» runtime/thÃ¡ng hoáº·c $5 credit (Ä‘á»§ cho testing)
- Supabase: 500MB database (Ä‘á»§ cho demo/testing)

---

## ğŸ“– Step 1: Deploy Database (Supabase)

### 1.1. Táº¡o Supabase Project

1. **Truy cáº­p:** https://supabase.com
2. **Sign up** báº±ng GitHub account
3. **Click "New Project"**
4. **Äiá»n thÃ´ng tin:**
   ```
   Name: optichain-db
   Database Password: [Táº¡o password máº¡nh]
   Region: Southeast Asia (Singapore)
   ```
5. **Click "Create new project"**
6. **Chá» 2-3 phÃºt** Ä‘á»ƒ database Ä‘Æ°á»£c setup

### 1.2. Import Schema

1. **Sidebar â†’ SQL Editor**
2. **Click "New query"**
3. **Copy toÃ n bá»™ ná»™i dung** tá»« `database/schema.sql`
4. **Paste vÃ o SQL Editor**
5. **Click "Run" hoáº·c Ctrl+Enter**
6. **Verify:** Tables Ä‘Ã£ Ä‘Æ°á»£c táº¡o

### 1.3. Láº¥y Connection String

1. **Settings (âš™ï¸) â†’ Database**
2. **Scroll xuá»‘ng "Connection string"**
3. **Chá»n "URI" tab**
4. **Copy connection string:**
   ```
   postgresql://postgres:[YOUR-PASSWORD]@db.xxx.supabase.co:5432/postgres
   ```
5. **LÆ°u láº¡i!**

**Xong bÆ°á»›c Database!** âœ…

---

## ğŸ“– Step 2: Deploy Backend (Railway)

### 2.1. Táº¡o Railway Account

1. **Truy cáº­p:** https://railway.app
2. **Click "Login with GitHub"**
3. **Authorize Railway**

### 2.2. Deploy tá»« GitHub

1. **Dashboard â†’ "New Project"**
2. **Click "Deploy from GitHub repo"**
3. **Chá»n repository:** `CodegymTuLG/aura`
4. **Click "Deploy Now"**
5. **Railway sáº½ tá»± detect Dockerfile**

**âš ï¸ Náº¿u Railway khÃ´ng detect Ä‘Æ°á»£c:**

### 2.3. Config Railway (Manual)

1. **Chá»n project vá»«a táº¡o**
2. **Click "Settings"**
3. **Root Directory:** `backend`
4. **Custom Start Command:**
   ```bash
   uvicorn app.main:app --host 0.0.0.0 --port $PORT
   ```

### 2.4. ThÃªm Environment Variables

1. **Tab "Variables"**
2. **Add cÃ¡c biáº¿n:**
   ```
   DATABASE_URL=postgresql://postgres:[PASSWORD]@db.xxx.supabase.co:5432/postgres
   SECRET_KEY=vZR9X7KpQ_M8NnYyH2JqLw5TFx3Bc4Ga1Sd6Vh0Ui9E
   ALGORITHM=HS256
   ACCESS_TOKEN_EXPIRE_MINUTES=30
   ALLOWED_ORIGINS=*
   PORT=8080
   ```

3. **Click "Add"** cho tá»«ng biáº¿n

### 2.5. Deploy

1. **Tab "Deployments"**
2. **Deployment sáº½ tá»± cháº¡y**
3. **Chá» 5-10 phÃºt**
4. **Check logs** Ä‘á»ƒ verify

### 2.6. Láº¥y Public URL

1. **Tab "Settings"**
2. **Section "Networking"**
3. **Click "Generate Domain"**
4. **Copy URL:** `https://optichain-backend-production.up.railway.app`
5. **LÆ°u láº¡i!**

### 2.7. Test Backend

```bash
# Test health
curl https://optichain-backend-production.up.railway.app/health

# Expected: {"status":"healthy"}
```

**Xong bÆ°á»›c Backend!** âœ…

---

## ğŸ“– Step 3: Deploy Frontend (Vercel)

### 3.1. Táº¡o Vercel Account

1. **Truy cáº­p:** https://vercel.com
2. **Click "Sign Up"**
3. **Login with GitHub**

### 3.2. Import Project

1. **Dashboard â†’ "Add New..." â†’ "Project"**
2. **Click "Import" cho repo `aura`**
3. **Configure Project:**
   ```
   Framework Preset: Next.js
   Root Directory: frontend
   Build Command: npm run build
   Output Directory: out
   ```

### 3.3. Environment Variables

1. **Section "Environment Variables"**
2. **Add:**
   ```
   NEXT_PUBLIC_API_URL=https://optichain-backend-production.up.railway.app/api/v1
   ```

### 3.4. Deploy

1. **Click "Deploy"**
2. **Chá» 2-3 phÃºt**
3. **Vercel sáº½ build vÃ  deploy tá»± Ä‘á»™ng**

### 3.5. Láº¥y URL

1. **Deployment complete**
2. **Copy URL:** `https://aura-xxx.vercel.app`
3. **LÆ°u láº¡i!**

### 3.6. Update Backend CORS

1. **Quay láº¡i Railway**
2. **Update ALLOWED_ORIGINS:**
   ```
   ALLOWED_ORIGINS=https://aura-xxx.vercel.app
   ```
3. **Redeploy backend**

**Xong bÆ°á»›c Frontend!** âœ…

---

## ğŸ“– Step 4: Deploy Mobile (Codemagic)

### 4.1. Setup Codemagic

1. **Truy cáº­p:** https://codemagic.io
2. **Sign up with GitHub**
3. **Add repository:** `CodegymTuLG/aura`

### 4.2. Configure Workflow

1. **Select repository**
2. **Workflow:** `android-workflow` (tá»« `codemagic.yaml`)
3. **Trigger:** On push to `develop_WS_DWS_ver1`

### 4.3. Update Mobile API URL

**TrÆ°á»›c khi push, update API URL:**

1. **Create file:** `mobile/lib/utils/config.dart`
   ```dart
   class Config {
     static const String apiUrl = 'https://optichain-backend-production.up.railway.app/api/v1';
   }
   ```

2. **Commit vÃ  push:**
   ```bash
   git add mobile/lib/utils/config.dart
   git commit -m "Update mobile API URL"
   git push origin develop_WS_DWS_ver1
   ```

3. **Codemagic sáº½ tá»± Ä‘á»™ng build**

### 4.4. Download APK

1. **Build complete (10-15 phÃºt)**
2. **Download APK** tá»« Artifacts
3. **Install trÃªn Android phone**

**Xong bÆ°á»›c Mobile!** âœ…

---

## ğŸ¯ TÃ³m táº¯t URLs

Sau khi deploy xong:

```
Database:  Supabase (Internal only)
Backend:   https://optichain-backend-production.up.railway.app
Frontend:  https://aura-xxx.vercel.app
Mobile:    Download APK tá»« Codemagic
```

---

## ğŸ’¡ Option 2: Render + Netlify + Neon

### Náº¿u muá»‘n thá»­ option khÃ¡c:

**Backend - Render.com:**
- Free tier: Unlimited
- Trade-off: Sleep sau 15 phÃºt khÃ´ng dÃ¹ng
- Wake up: ~30 giÃ¢y khi cÃ³ request Ä‘áº§u tiÃªn

**Frontend - Netlify:**
- TÆ°Æ¡ng tá»± Vercel
- 100GB bandwidth/thÃ¡ng

**Database - Neon:**
- PostgreSQL serverless
- Free: 0.5GB storage
- KhÃ´ng bá»‹ xÃ³a

### Quick Setup:

1. **Neon DB:**
   - https://neon.tech â†’ Sign up
   - Create project â†’ Copy connection string

2. **Render Backend:**
   - https://render.com â†’ Sign up
   - New â†’ Web Service â†’ Connect repo
   - Root: `backend`
   - Start: `uvicorn app.main:app --host 0.0.0.0 --port $PORT`
   - Add env vars

3. **Netlify Frontend:**
   - https://netlify.com â†’ Sign up
   - Import from Git
   - Build: `cd frontend && npm run build`
   - Publish: `frontend/out`

---

## ğŸ’¡ Option 3: Firebase Only (Cáº§n refactor Backend)

### Náº¿u muá»‘n ALL-IN-ONE vá»›i Firebase:

**Trade-off:** Pháº£i viáº¿t láº¡i Backend thÃ nh Firebase Functions

**Pros:**
- HoÃ n toÃ n free
- Auto-scaling
- Integrated vá»›i Firebase services

**Cons:**
- Pháº£i refactor Backend tá»« FastAPI â†’ Cloud Functions
- Firestore thay vÃ¬ PostgreSQL (khÃ¡c data model)
- Cold start cháº­m

**KhÃ´ng recommend cho hiá»‡n táº¡i** - Giá»¯ nguyÃªn FastAPI tá»‘t hÆ¡n.

---

## ğŸ“Š So sÃ¡nh Chi phÃ­

### Railway + Vercel + Supabase:

| Metric | Free Tier | VÆ°á»£t thÃ¬ sao? |
|--------|-----------|---------------|
| Railway uptime | 500 giá»/thÃ¡ng | Sau Ä‘Ã³ $5/month |
| Vercel bandwidth | 100GB/thÃ¡ng | Unlimited miá»…n phÃ­ |
| Supabase storage | 500MB | Upgrade $25/month |

**Dá»± kiáº¿n:** Äá»§ dÃ¹ng 1-3 thÃ¡ng testing/demo

### Render + Netlify + Neon:

| Metric | Free Tier | Trade-off |
|--------|-----------|-----------|
| Render uptime | Unlimited | Sleep 15 phÃºt |
| Netlify bandwidth | 100GB | Äá»§ dÃ¹ng |
| Neon storage | 0.5GB | Nhá» hÆ¡n Supabase |

**Dá»± kiáº¿n:** DÃ¹ng vÄ©nh viá»…n miá»…n phÃ­ (cÃ³ sleep)

---

## ğŸ”„ Auto-Redeploy

### Railway (tá»« GitHub):
- Push code â†’ Auto deploy
- Branch: `develop_WS_DWS_ver1`

### Vercel (tá»« GitHub):
- Push code â†’ Auto deploy
- Preview URLs cho má»—i PR

### Codemagic (tá»« GitHub):
- Push code â†’ Auto build mobile
- Workflow tá»± Ä‘á»™ng

---

## ğŸš¨ Giá»›i háº¡n cáº§n lÆ°u Ã½

### Railway Free Tier:
- **500 giá»/thÃ¡ng** = ~20 ngÃ y liÃªn tá»¥c
- **Hoáº·c $5 credit** (háº¿t credit thÃ¬ service stop)
- **Solution:** Monitor usage, pause khi khÃ´ng dÃ¹ng

### Supabase Free:
- **500MB database** = Äá»§ cho ~50K records
- **2GB bandwidth/thÃ¡ng** = Äá»§ cho testing
- **Solution:** Clean up data cÅ© thÆ°á»ng xuyÃªn

### Render Free (náº¿u dÃ¹ng):
- **Sleep sau 15 phÃºt** khÃ´ng cÃ³ request
- **Wake up ~30 giÃ¢y** khi cÃ³ request má»›i
- **Solution:** Cháº¥p nháº­n hoáº·c dÃ¹ng Railway

---

## âœ… Checklist Deploy FREE

- [ ] Táº¡o Supabase account & database
- [ ] Import schema vÃ o Supabase
- [ ] Láº¥y Supabase connection string
- [ ] Táº¡o Railway account
- [ ] Deploy backend lÃªn Railway
- [ ] Add environment variables
- [ ] Generate Railway public URL
- [ ] Test backend API
- [ ] Táº¡o Vercel account
- [ ] Deploy frontend lÃªn Vercel
- [ ] Add API URL vÃ o Vercel env
- [ ] Update CORS trong Railway
- [ ] Test frontend káº¿t ná»‘i backend
- [ ] Setup Codemagic
- [ ] Update mobile API URL
- [ ] Push code Ä‘á»ƒ trigger Codemagic
- [ ] Download vÃ  test APK

---

## ğŸ“ Support & Monitoring

### Monitor Railway Usage:
1. Railway Dashboard â†’ Usage
2. Check "Hours used" vÃ  "Credit remaining"
3. Alert khi gáº§n háº¿t

### Monitor Supabase:
1. Supabase Dashboard â†’ Database
2. Check storage usage
3. Alert khi > 400MB

### Logs:
```bash
# Railway logs
# â†’ Railway Dashboard â†’ Deployments â†’ View logs

# Vercel logs
# â†’ Vercel Dashboard â†’ Deployments â†’ Function logs
```

---

## ğŸ“ Script Deploy cho FREE Option

Táº¡o script má»›i cho Railway deployment:

```bash
# scripts/deploy-backend-railway.sh

#!/bin/bash
echo "ğŸš€ Deploying to Railway..."

# Install Railway CLI
npm install -g @railway/cli

# Login
railway login

# Link project
railway link

# Deploy
railway up

echo "âœ… Backend deployed to Railway!"
```

---

## ğŸ”„ Upgrade Path (Khi cÃ³ kinh phÃ­)

**Tá»« FREE â†’ Paid:**

1. **Railway â†’ Cloud Run**
   - Export DATABASE_URL tá»« Railway
   - Follow `DEPLOY-BACKEND-CLOUDRUN.md`

2. **Supabase â†’ Cloud SQL**
   - Export database: `pg_dump`
   - Import vÃ o Cloud SQL

3. **Vercel â†’ Firebase Hosting**
   - CÃ¹ng stack, chá»‰ Ä‘á»•i hosting

**Migration time:** ~1-2 giá»

---

## ğŸ“ Next Steps

**Báº¯t Ä‘áº§u deploy FREE ngay:**

1. **Start vá»›i Database:** [Section Step 1](#-step-1-deploy-database-supabase)
2. **Deploy Backend:** [Section Step 2](#-step-2-deploy-backend-railway)
3. **Deploy Frontend:** [Section Step 3](#-step-3-deploy-frontend-vercel)
4. **Build Mobile:** [Section Step 4](#-step-4-deploy-mobile-codemagic)

**Estimated time:** 1-2 giá» (láº§n Ä‘áº§u)

---

**Last updated**: 2025-12-26
**Recommended for**: Testing, Demo, MVP
**Cost**: $0/month âœ…
