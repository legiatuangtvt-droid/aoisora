<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý Mã Ca Làm Việc</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Thiết lập font Inter */
        html { font-family: 'Inter', sans-serif; }
    </style>
    <script>
        // Dữ liệu mẫu (Tạm thời)
        let shiftCodes = [];

        // --- Logic Hiển thị/Đóng Modal (M) ---
        function openManualShiftModal() {
            const modal = document.getElementById('manual-shift-modal');
            modal.style.display = 'flex';
        }

        function closeManualShiftModal() {
            const modal = document.getElementById('manual-shift-modal');
            modal.style.display = 'none';
            // Reset form
            document.getElementById('manual-shift-form').reset();
        }

        // Xử lý lưu Mã Ca Thủ Công (Placeholder)
        function handleManualShiftSave(event) {
            event.preventDefault();
            
            const code = document.getElementById('shift-code-manual').value.toUpperCase();
            const startTime = document.getElementById('start-time-manual').value;
            const endTime = document.getElementById('end-time-manual').value;
            
            // Tính toán tổng giờ (Placeholder) - Theo 4.2 Luồng Thêm Mã Ca Thủ Công
            // Logic tính toán sẽ phức tạp hơn trong thực tế, đây là placeholder:
            const totalHours = "8.0"; 

            const newShift = {
                code: code,
                time: `${startTime} - ${endTime}`,
                totalHours: parseFloat(totalHours)
            };
            
            // Thêm vào danh sách (Nếu là app thực tế sẽ gọi API)
            shiftCodes.push(newShift);
            renderShiftCodeList(); // Cập nhật bảng
            closeManualShiftModal();
            showInfo(`Đã thêm mã ca thủ công: ${code}`);
        }

        // Hiển thị thông báo (thay thế cho alert)
        function showInfo(message) {
            const infoBox = document.getElementById('info-box');
            infoBox.textContent = message;
            infoBox.style.display = 'block';
            setTimeout(() => {
                infoBox.style.display = 'none';
            }, 3000);
        }

        // Render Danh Sách Mã Ca (Placeholder cho 3.2)
        function renderShiftCodeList() {
            const tableBody = document.getElementById('shift-code-list-body');
            if (shiftCodes.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="4" class="text-center py-4 text-gray-500">Chưa có mã ca nào được tạo.</td>
                    </tr>
                `;
                return;
            }

            tableBody.innerHTML = shiftCodes.map((shift, index) => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-3">${index + 1}</td>
                    <td class="px-6 py-3 font-semibold">${shift.code}</td>
                    <td class="px-6 py-3">${shift.time}</td>
                    <td class="px-6 py-3">${shift.totalHours}</td>
                </tr>
            `).join('');
        }

        // Khởi tạo giao diện khi tải trang
        window.onload = function() {
            renderShiftCodeList();
        };

    </script>
</head>
<body class="bg-slate-100 min-h-screen">
    
    <!-- Info Box (thay thế alert) -->
    <div id="info-box" class="fixed top-5 right-5 bg-green-500 text-white px-6 py-3 rounded-lg shadow-xl hidden transition-opacity duration-300" style="z-index: 1050;">
        Thao tác thành công!
    </div>

    <div class="container mx-auto p-4 lg:p-8">
        
        <h1 class="text-3xl font-extrabold text-slate-800 mb-6">Quản Lý Mã Ca Làm Việc</h1>

        <!-- PHẦN A: Tạo Mã Ca Tự Động (Placeholder) -->
        <div class="bg-white p-6 rounded-xl shadow-lg mb-8">
            <h2 class="text-xl font-bold text-slate-700 mb-4">Tạo Mã Ca Tự Động</h2>
            <!-- Placeholder cho Form Tạo Tự Động (A01 - A05) -->
            <div class="grid grid-cols-1 md:grid-cols-5 gap-4 items-end">
                <input type="text" placeholder="Ký tự (A01)" class="border p-3 rounded-lg col-span-1" maxlength="1">
                <input type="number" placeholder="Giờ Min (A02)" step="0.5" class="border p-3 rounded-lg">
                <input type="number" placeholder="Giờ Max (A03)" step="0.5" class="border p-3 rounded-lg">
                <input type="time" placeholder="Bắt đầu từ (A04)" step="1800" class="border p-3 rounded-lg">
                <input type="time" placeholder="Kết thúc muộn nhất (A05)" step="1800" class="border p-3 rounded-lg">
            </div>
            <div class="flex justify-between mt-6">
                <!-- A07: Nút "Thêm mã ca" -->
                <button onclick="openManualShiftModal()" class="flex items-center bg-green-500 text-white px-5 py-2 rounded-lg shadow-md hover:bg-green-600 transition">
                    Thêm mã ca thủ công
                </button>
                <!-- A06: Nút "Tạo Mã ca" -->
                <button class="bg-blue-600 text-white px-6 py-2 rounded-lg shadow-md hover:bg-blue-700 transition">
                    Tạo Mã ca
                </button>
            </div>
        </div>

        <!-- PHẦN L: Danh Sách Mã Ca Làm Việc (3.2) -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden">
            <h2 class="text-xl font-bold text-slate-700 p-6 border-b">Danh Sách Mã Ca Làm Việc</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">STT</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mã Ca Làm Việc (L02)</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Thời gian làm việc (L03)</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tổng giờ (L04)</th>
                        </tr>
                    </thead>
                    <tbody id="shift-code-list-body" class="bg-white divide-y divide-gray-200">
                        <!-- Dữ liệu sẽ được JS render (renderShiftCodeList) -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- MODAL THÊM MÃ CA THỦ CÔNG (M) - Theo 3.3. Chức Năng Thêm Mã Ca Thủ Công -->
    <div id="manual-shift-modal" class="fixed inset-0 bg-gray-900 bg-opacity-70 hidden items-center justify-center z-50 transition-opacity duration-300">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-lg transform scale-95 opacity-0 transition-all duration-300" style="display: none;">
            <h2 class="text-2xl font-extrabold text-slate-800 mb-6 border-b pb-3">Thêm Mã Ca Thủ Công</h2>
            
            <form id="manual-shift-form" onsubmit="handleManualShiftSave(event)">
                
                <!-- M01: Mã Ca (*) -->
                <div class="mb-4">
                    <label for="shift-code-manual" class="block text-sm font-semibold text-gray-700 mb-1">Mã Ca (*)</label>
                    <input type="text" id="shift-code-manual" 
                           class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:border-blue-500 focus:ring-blue-500 uppercase" 
                           placeholder="Ví dụ: V8.516"
                           required>
                </div>
                
                <!-- M02: Giờ Bắt Đầu (*) -->
                <div class="mb-4">
                    <label for="start-time-manual" class="block text-sm font-semibold text-gray-700 mb-1">Giờ Bắt Đầu (*)</label>
                    <input type="time" id="start-time-manual" step="1800" 
                           class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:border-blue-500 focus:ring-blue-500" 
                           required>
                </div>
                
                <!-- M03: Giờ Kết Thúc (*) -->
                <div class="mb-6">
                    <label for="end-time-manual" class="block text-sm font-semibold text-gray-700 mb-1">Giờ Kết Thúc (*)</label>
                    <input type="time" id="end-time-manual" step="1800" 
                           class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:border-blue-500 focus:ring-blue-500" 
                           required>
                </div>

                <!-- M04, M05: Nút Hủy và Lưu -->
                <div class="flex justify-end space-x-3 pt-4 border-t">
                    <button type="button" onclick="closeManualShiftModal()" class="px-5 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">Hủy (M04)</button>
                    <button type="submit" id="save-manual-shift" class="px-5 py-2 bg-blue-600 text-white rounded-lg shadow-md hover:bg-blue-700 transition">Lưu (M05)</button>
                </div>
            </form>
        </div>
    </div>
    <script>
        // Cần phải chạy lại JS sau khi Modal đã được thêm vào DOM
        window.onload = function() {
            // Cập nhật hàm mở modal để thêm hiệu ứng chuyển đổi
            window.openManualShiftModal = function() {
                const modalWrapper = document.getElementById('manual-shift-modal');
                const modalContent = modalWrapper.children[0];

                // Hiển thị wrapper
                modalWrapper.style.display = 'flex';
                // Áp dụng chuyển đổi
                setTimeout(() => {
                    modalContent.style.opacity = '1';
                    modalContent.style.transform = 'scale(1)';
                }, 10); // Chờ 10ms để trình duyệt nhận ra sự thay đổi display
            }

            // Cập nhật hàm đóng modal để thêm hiệu ứng chuyển đổi
            window.closeManualShiftModal = function() {
                const modalWrapper = document.getElementById('manual-shift-modal');
                const modalContent = modalWrapper.children[0];

                // Áp dụng chuyển đổi ngược
                modalContent.style.opacity = '0';
                modalContent.style.transform = 'scale(0.95)';

                // Sau khi chuyển đổi kết thúc, ẩn wrapper
                setTimeout(() => {
                    modalWrapper.style.style.display = 'none';
                    document.getElementById('manual-shift-form').reset();
                }, 300); // Tương ứng với thời gian transition (300ms)
            }

            // Khởi tạo danh sách mã ca
            renderShiftCodeList();
        };

        // Hàm này được đặt ở đây để có thể truy cập được sau khi modal được thêm vào
        window.closeManualShiftModal = function() {
            const modalWrapper = document.getElementById('manual-shift-modal');
            const modalContent = modalWrapper.children[0];

            // Áp dụng chuyển đổi ngược
            modalContent.style.opacity = '0';
            modalContent.style.transform = 'scale(0.95)';

            // Sau khi chuyển đổi kết thúc, ẩn wrapper
            setTimeout(() => {
                modalWrapper.style.display = 'none';
                document.getElementById('manual-shift-form').reset();
            }, 300); // Tương ứng với thời gian transition (300ms)
        }
    </script>
</body>
</html>