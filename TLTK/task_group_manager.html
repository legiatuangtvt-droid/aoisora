<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý Nhóm Task (Task Group Manager)</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Thiết lập font Inter */
        html { font-family: 'Inter', sans-serif; }

        /* Định nghĩa Scrollbar cho khu vực cuộn ngang */
        .horizontal-scroll-container::-webkit-scrollbar {
            height: 8px;
        }

        .horizontal-scroll-container::-webkit-scrollbar-thumb {
            background-color: #cbd5e1; /* slate-300 */
            border-radius: 4px;
        }

        .horizontal-scroll-container::-webkit-scrollbar-track {
            background-color: #f1f5f9; /* slate-100 */
        }
        
        /* Hiệu ứng Mờ (Deemphasized State) */
        .task-card.deemphasized {
            opacity: 0.3;
            filter: grayscale(80%);
            transition: opacity 0.3s, filter 0.3s;
        }

        /* Hiệu ứng Highlight */
        .task-card.highlighted {
            opacity: 1;
            filter: none;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4); /* ring-blue-600 */
            border-color: #2563eb;
            transform: scale(1.05);
        }

        /* Thẻ thống kê Header đang Active */
        .stat-card.active {
            background-color: #1d4ed8; /* blue-700 */
            color: white;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transform: translateY(-2px);
        }

        /* Task Card default state */
        .task-card {
            transition: all 0.3s ease;
        }

    </style>
    <script>
        // --- Dữ liệu Mẫu Task Groups ---
        const taskGroups = [
            { id: 1, name: "POS (Point of Sale)", order: 1, totalTasks: 12, tasks: [
                { id: 101, name: "Kiểm tra màn hình", code: "1101", frequency: "Daily" },
                { id: 102, name: "Báo cáo doanh số", code: "1102", frequency: "Daily" },
                { id: 103, name: "Kiểm kê vật tư POS", code: "1103", frequency: "Weekly" },
                { id: 104, name: "Cập nhật giá", code: "1104", frequency: "Daily" },
                { id: 105, name: "Backup dữ liệu", code: "1105", frequency: "Monthly" },
                { id: 106, name: "Vệ sinh thiết bị", code: "1106", frequency: "Daily" },
                { id: 107, name: "Kiểm tra kết nối mạng", code: "1107", frequency: "Daily" },
                { id: 108, name: "Xử lý hàng hoàn", code: "1108", frequency: "Weekly" },
                { id: 109, name: "Kiểm tra pin dự phòng", code: "1109", frequency: "Monthly" },
                { id: 110, name: "Đào tạo nhân viên", code: "1110", frequency: "Yearly" },
            ]},
            { id: 2, name: "PERI (Perishables)", order: 2, totalTasks: 9, tasks: [
                { id: 201, name: "Kiểm tra nhiệt độ", code: "1201", frequency: "Daily" },
                { id: 202, name: "Xử lý hàng cận date", code: "1202", frequency: "Daily" },
                { id: 203, name: "Sắp xếp kho lạnh", code: "1203", frequency: "Weekly" },
                { id: 204, name: "Kiểm tra hải sản", code: "1204", frequency: "Daily" },
                { id: 205, name: "Vệ sinh quầy thịt", code: "1205", frequency: "Daily" },
                { id: 206, name: "Đóng gói rau củ", code: "1206", frequency: "Daily" },
                { id: 207, name: "Kiểm kê chất lượng", code: "1207", frequency: "Weekly" },
                { id: 208, name: "Kiểm tra sản phẩm tươi", code: "1208", frequency: "Daily" },
            ]},
            { id: 3, name: "DELICA", order: 7, totalTasks: 6, tasks: [
                { id: 301, name: "Kiểm tra chất lượng món ăn", code: "1701", frequency: "Daily" },
                { id: 302, name: "Lên menu mới", code: "1702", frequency: "Monthly" },
                { id: 303, name: "Kiểm kê nguyên liệu", code: "1703", frequency: "Weekly" },
                { id: 304, name: "Vệ sinh bếp", code: "1704", frequency: "Daily" },
                { id: 305, name: "Kiểm tra lò nướng", code: "1705", frequency: "Monthly" },
            ]},
        ];

        // Tính toán Thống kê Header
        function calculateStats() {
            let total = 0;
            let daily = 0;
            let weekly = 0;
            let monthly = 0;
            let yearly = 0;

            taskGroups.forEach(group => {
                group.tasks.forEach(task => {
                    total++;
                    if (task.frequency === "Daily") daily++;
                    if (task.frequency === "Weekly") weekly++;
                    if (task.frequency === "Monthly") monthly++;
                    if (task.frequency === "Yearly") yearly++;
                });
            });

            return { total, daily, weekly, monthly, yearly };
        }

        let currentFilter = 'Total'; // Mặc định là Total

        // Render Header Thống kê
        function renderHeaderStats() {
            const stats = calculateStats();
            const container = document.getElementById('header-stats');
            
            const statItems = [
                { id: 'H01', name: 'Total Task', count: stats.total, filter: 'Total' },
                { id: 'H02', name: 'Daily Task', count: stats.daily, filter: 'Daily' },
                { id: 'H03', name: 'Weekly Task', count: stats.weekly, filter: 'Weekly' },
                { id: 'H04', name: 'Monthly Task', count: stats.monthly, filter: 'Monthly' },
                { id: 'H05', name: 'Yearly Task', count: stats.yearly, filter: 'Yearly' },
            ];

            container.innerHTML = statItems.map(item => `
                <div id="${item.id}" class="stat-card flex-1 bg-white p-4 rounded-xl shadow-lg cursor-pointer transition transform hover:shadow-xl hover:scale-[1.01] ${currentFilter === item.filter ? 'active' : ''}" 
                     onclick="setFilter('${item.filter}')">
                    <p class="text-sm font-medium ${currentFilter === item.filter ? 'text-blue-200' : 'text-slate-500'}">${item.name}</p>
                    <p class="text-3xl font-bold ${currentFilter === item.filter ? 'text-white' : 'text-slate-800'}">${item.count}</p>
                </div>
            `).join('');
        }

        // Render Task Group Cards
        function renderTaskGroups() {
            const container = document.getElementById('task-groups-container');
            container.innerHTML = taskGroups.sort((a, b) => a.order - b.order).map(group => {
                const taskCards = group.tasks.map((task, index) => {
                    const isHighlighted = currentFilter === 'Total' || task.frequency === currentFilter;
                    const highlightClass = isHighlighted ? 'highlighted' : 'deemphasized';
                    
                    // Logic Mã Task Tự động (Ví dụ: Group 7, Task 5 -> 1705)
                    const taskOrderPadded = (index + 1).toString().padStart(2, '0');
                    const taskCode = `1${group.order}${taskOrderPadded}`;

                    return `
                        <div class="task-card flex-shrink-0 w-32 h-32 bg-white border border-slate-200 rounded-lg p-3 mx-2 shadow-sm flex flex-col justify-between ${highlightClass}">
                            <div class="flex-grow flex items-center justify-center text-center">
                                <p class="text-sm font-semibold text-slate-700">${task.name}</p>
                            </div>
                            <p class="text-xs text-center font-mono text-slate-500 mt-1">${taskCode}</p>
                        </div>
                    `;
                }).join('');

                return `
                    <div class="task-group-row flex items-stretch border-b border-slate-200 py-4 hover:bg-slate-50 transition">
                        
                        <!-- Ô 1: Group Name & Count -->
                        <div class="w-1/6 flex flex-col justify-center items-center p-3">
                            <p class="text-lg font-bold text-slate-800 text-center">${group.name}</p>
                            <p class="text-xs text-slate-500 mt-1 text-center">(${group.totalTasks} Task)</p>
                        </div>

                        <!-- Ô 2: Danh sách Task (Cuộn ngang) -->
                        <div class="w-4/6 p-3">
                            <div class="flex overflow-x-auto horizontal-scroll-container pb-2">
                                ${taskCards}
                                
                                <!-- Thẻ Đếm Task 4 Ô (Mô phỏng 1,2,3,4, 5,6,7,8,...) -->
                                <div class="flex flex-col items-start ml-4 text-xs font-semibold text-slate-600 space-y-1">
                                    <div class="h-14 flex items-end">
                                        <p class="text-xs text-slate-400">Task No:</p>
                                    </div>
                                    <div class="flex">
                                        ${[1, 5, 9, 13].map(num => `<span class="w-32 text-center text-slate-500">${num}-${num+3}</span>`).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Ô 3: Actions -->
                        <div class="w-1/6 flex justify-end items-center p-3 space-x-2">
                            <button class="text-blue-500 hover:text-blue-700 p-2 rounded-full hover:bg-blue-50 transition" title="Chỉnh sửa">
                                <!-- Icon Edit -->
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-square-pen"><path d="M12 3a7 7 0 0 0-7 7v4a7 7 0 0 0 7 7h4a7 7 0 0 0 7-7v-4a7 7 0 0 0-7-7z"/><path d="M12 3v18M3 12h18"/></svg>
                            </button>
                            <button class="text-red-500 hover:text-red-700 p-2 rounded-full hover:bg-red-50 transition" title="Xóa">
                                <!-- Icon Delete -->
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Cài đặt Bộ lọc và re-render giao diện
        function setFilter(filter) {
            currentFilter = filter;
            renderAll();
        }

        // Thêm nút "Thêm Nhóm Task Mới"
        function renderActionBar() {
             const actionBar = document.getElementById('action-bar');
             actionBar.innerHTML = `
                <button class="flex items-center bg-blue-600 text-white px-5 py-2 rounded-lg shadow-md hover:bg-blue-700 transition" 
                        onclick="showInfo('Mở Popup G00: Thêm Nhóm Task Mới')">
                    <!-- Icon Plus -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus mr-2"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
                    Thêm Nhóm Task Mới
                </button>
             `;
        }

        // Hiển thị thông báo (thay thế cho alert)
        function showInfo(message) {
            const infoBox = document.getElementById('info-box');
            infoBox.textContent = message;
            infoBox.style.display = 'block';
            setTimeout(() => {
                infoBox.style.display = 'none';
            }, 3000);
        }

        // Hàm tổng hợp render
        function renderAll() {
            renderHeaderStats();
            renderTaskGroups();
        }

        // Khởi tạo giao diện khi tải trang
        window.onload = function() {
            renderAll();
            renderActionBar();
        };

    </script>
</head>
<body class="bg-slate-100 min-h-screen">
    
    <!-- Info Box (thay thế alert) -->
    <div id="info-box" class="fixed top-5 right-5 bg-green-500 text-white px-6 py-3 rounded-lg shadow-xl hidden transition-opacity duration-300" style="z-index: 1050;">
        Thao tác thành công!
    </div>

    <div class="container mx-auto p-4 lg:p-8">
        
        <!-- Tiêu đề Màn hình -->
        <h1 class="text-3xl font-extrabold text-slate-800 mb-6">Quản lý Nhóm Task</h1>

        <!-- Thanh Action Bar -->
        <div id="action-bar" class="mb-8 flex justify-end">
            <!-- Nút "Thêm Nhóm Task Mới" sẽ được JS render -->
        </div>

        <!-- PHẦN III: 3.1. Header Thống kê (Statistics Cards) -->
        <div id="header-stats" class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8">
            <!-- Thẻ Thống kê sẽ được JS render -->
        </div>

        <!-- Khu vực Nội dung chính (Main Content) - Cho phép cuộn dọc -->
        <div class="bg-white rounded-2xl shadow-xl overflow-y-auto max-h-[70vh]">
            
            <!-- Header cố định của bảng (để phân biệt cột) -->
            <div class="flex border-b-2 border-slate-300 font-semibold text-sm text-slate-600 sticky top-0 bg-white z-10">
                <div class="w-1/6 p-3 text-center">Tên Nhóm (G01)</div>
                <div class="w-4/6 p-3">Danh sách Task (Cuộn ngang)</div>
                <div class="w-1/6 p-3 text-right">Actions</div>
            </div>

            <!-- PHẦN III: 3.2. Cấu trúc Thẻ Task Group -->
            <div id="task-groups-container">
                <!-- Các Task Group Row sẽ được JS render -->
            </div>
            
            <!-- Vùng đệm cuối để dễ cuộn -->
            <div class="h-4"></div>

        </div>
    </div>

</body>
</html>