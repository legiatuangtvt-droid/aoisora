## TÀI LIỆU THUYẾT MINH DỰ ÁN "AOISORA" - HỆ THỐNG QUẢN LÝ LỊCH LÀM VIỆC

**Phiên bản:** 1.0
**Ngày tạo:** 2024-07-25

### 1. TỔNG QUAN DỰ ÁN

**AoiSora** là một ứng dụng web được thiết kế để quản lý và phân công lịch làm việc cho nhân viên tại các cửa hàng. Dự án tập trung vào việc cung cấp một giao diện trực quan, dễ sử dụng để lập kế hoạch, theo dõi và điều chỉnh công việc hàng ngày, hàng tháng.

**Công nghệ sử dụng:**
- **Frontend:** HTML, JavaScript (ES6).
- **Styling:** TailwindCSS, Font Awesome (cho icons).
- **Thư viện JavaScript:** SortableJS (cho chức năng kéo-thả).
- **Kiến trúc dữ liệu:** Toàn bộ dữ liệu (lịch làm việc, công việc, nhân viên) hiện đang được giả lập (mock) bằng các đối tượng JavaScript trực tiếp trong các file HTML.

---

### 2. MÔ TẢ CHI TIẾT CÁC TRANG (TÍNH NĂNG & LOGIC)

Dự án bao gồm các trang chính sau, mỗi trang phục vụ một mục đích quản lý cụ thể:

#### 2.1. Lịch Hàng Ngày (index.html)

Đây là trang chức năng cốt lõi và phức tạp nhất của hệ thống, cung cấp cái nhìn chi tiết về lịch làm việc trong một ngày cụ thể.

**a. Tính năng:**
- **Hiển thị Lịch Dạng Lưới (Grid View):**
  - Mỗi hàng đại diện cho một nhân viên đi làm trong ngày, hiển thị thông tin: Tên, Chức vụ (Role), Ca làm việc, và một biểu đồ tròn giả lập tiến độ công việc.
  - Các cột đại diện cho các khung giờ trong ngày (ví dụ: 6:00, 7:00, 8:00,...).
  - Giao điểm giữa hàng (nhân viên) và cột (khung giờ) là nơi hiển thị các thẻ công việc (task card) được giao cho nhân viên đó vào giờ đó.
- **Điều hướng Ngày:** Người dùng có thể chuyển tới/lui giữa các ngày bằng nút mũi tên hoặc chọn một ngày cụ thể từ ô `input type="date"`.
- **Kéo và Thả (Drag and Drop):**
  - Người dùng có thể kéo một thẻ công việc từ khung giờ này sang khung giờ khác của cùng một nhân viên.
  - Người dùng có thể kéo một thẻ công việc từ nhân viên này sang nhân viên khác (trong cùng một khung giờ hoặc khác khung giờ).
  - Đây là tính năng trung tâm, cho phép điều phối lại công việc một cách linh hoạt.
- **Xóa Công Việc:** Khi di chuột vào một thẻ công việc, nút xóa (dấu 'x') sẽ hiện ra, cho phép người quản lý gỡ bỏ công việc đó khỏi lịch.
- **Thêm Lịch Làm Việc Mới:**
  - Nút "Thêm Lịch Làm Việc" (ở sidebar và header) sẽ mở một modal.
  - Modal cho phép chọn Nhân viên, Ngày, Ca làm việc và nhập danh sách mã công việc (phân cách bằng dấu phẩy) để nhanh chóng tạo một lịch trình mới cho nhân viên.
- **Tính toán Man Hour:** Header của lưới lịch tự động tính toán và hiển thị tổng số "Man Hour" (số lượng nhân viên có công việc) cho mỗi khung giờ, giúp người quản lý đánh giá nhanh mức độ tập trung nhân sự.

**b. Logic hoạt động:**
- **Nguồn dữ liệu:** Biến `scheduleByDate` là một đối tượng lớn, chứa dữ liệu lịch làm việc được nhóm theo từng ngày (key là ngày dạng `YYYY-MM-DD`).
- **Render Giao diện (`renderSchedule()`):**
  1. Khi trang được tải hoặc ngày được thay đổi, hàm `renderSchedule()` được gọi.
  2. Hàm này đọc dữ liệu từ `scheduleByDate` tương ứng với ngày đã chọn.
  3. Nó tính toán `Man Hour` cho mỗi khung giờ.
  4. Dựng cấu trúc HTML cho toàn bộ lưới lịch: tạo các hàng cho nhân viên và các ô cho từng khung giờ, sau đó chèn các thẻ công việc vào đúng vị trí.
- **Xử lý Kéo-Thả:**
  1. Thư viện `SortableJS` được khởi tạo trên tất cả các ô chứa công việc (`.sub-task-grid`).
  2. Khi một hành động kéo-thả kết thúc (`onEnd` event), hàm `updateScheduleDataFromDOM()` được kích hoạt.
  3. `updateScheduleDataFromDOM()` sẽ quét toàn bộ cấu trúc DOM của lưới lịch, đọc vị trí mới của tất cả các thẻ công việc.
  4. Dựa trên thông tin đọc được, nó **cập nhật lại đối tượng JavaScript `scheduleByDate`** để phản ánh sự thay đổi.
  5. Cuối cùng, `renderSchedule()` được gọi lại để "vẽ lại" toàn bộ giao diện từ dữ liệu đã được cập nhật. Việc vẽ lại này đảm bảo tính nhất quán của dữ liệu và giao diện, đồng thời cập nhật lại `Man Hour`.
- **Xử lý Xóa (`deleteTask()`):**
  1. Khi nút xóa được nhấn, thẻ công việc tương ứng sẽ bị xóa khỏi DOM.
  2. Tương tự như kéo-thả, `updateScheduleDataFromDOM()` và `renderSchedule()` được gọi để cập nhật dữ liệu và giao diện.

---

#### 2.2. Lịch Hàng Tháng (month.html)

Cung cấp cái nhìn tổng quan về lịch làm việc của tất cả nhân viên trong một tháng.

**a. Tính năng:**
- **Hiển thị Lịch Dạng Tháng:** Giao diện lịch chuẩn, hiển thị các ngày trong tháng.
- **Hiển thị Ca Làm Việc:** Trong mỗi ô ngày, hệ thống liệt kê danh sách nhân viên và ca làm việc được phân công (ví dụ: V.An: Ca Sáng, T.Bình: Ca Chiều).
- **Điều hướng Tháng:** Người dùng có thể chuyển tới/lui giữa các tháng.

**b. Logic hoạt động:**
- Dữ liệu được giả lập trong biến `scheduleData`, map ngày với danh sách ca làm của nhân viên.
- Hàm `renderCalendar()` sẽ tính toán ngày đầu tiên, ngày cuối cùng của tháng hiện tại và render toàn bộ các ô ngày. Dữ liệu ca làm sẽ được đọc từ `scheduleData` và chèn vào ô ngày tương ứng.

---

#### 2.3. Quản Lý Công Việc Chính (main-tasks.html)

Trang quản lý danh mục các công việc đơn lẻ có thể được phân công.

**a. Tính năng:**
- **Danh sách Công việc:** Hiển thị bảng liệt kê các công việc chính với thông tin: Mã, Tên, Mô tả, Nhóm công việc, Thời gian ước tính.
- **Thêm Công việc mới:** Modal cho phép tạo một công việc mới bằng cách nhập các thông tin trên.
- **Hành động:** Các nút Sửa/Xóa (hiện tại chỉ là giao diện, chưa có logic).

**b. Logic hoạt động:**
- Dữ liệu được giả lập trong mảng `mainTasks`.
- Hàm `renderMainTasks()` đọc dữ liệu từ mảng này và tạo các hàng trong bảng.
- Form thêm mới sẽ `push` một đối tượng công việc mới vào mảng `mainTasks` và gọi lại `renderMainTasks()` để cập nhật bảng.

---

#### 2.4. Quản Lý Nhóm Công Việc (task-groups.html)

Trang để tạo và quản lý các nhóm chứa nhiều công việc chính.

**a. Tính năng:**
- **Danh sách Nhóm:** Hiển thị bảng liệt kê các nhóm công việc với thông tin: ID, Tên, Mô tả, Số lượng công việc trong nhóm.
- **Thêm Nhóm mới:** Modal cho phép tạo một nhóm công việc mới.

**b. Logic hoạt động:**
- Tương tự trang Công Việc Chính, dữ liệu được quản lý trong mảng `taskGroups` và được render ra bảng bởi hàm `renderTaskGroups()`.

---

#### 2.5. Quản Lý Nhân Viên (staff.html) & Cửa Hàng (store.html)

Đây là các trang quản lý danh mục, hiện tại chỉ hiển thị dữ liệu tĩnh.

- **Tính năng:** Hiển thị danh sách nhân viên/cửa hàng dưới dạng bảng với các thông tin cơ bản.
- **Logic hoạt động:** Dữ liệu được hard-code trực tiếp trong HTML, chưa có logic JavaScript để thêm/sửa/xóa.

---

### 3. QUAN HỆ TƯƠNG TÁC GIỮA CÁC TRANG

Mặc dù các trang được xây dựng riêng lẻ, chúng có mối quan hệ logic chặt chẽ, tạo thành một hệ thống quản lý hoàn chỉnh.

1.  **Công Việc Chính (`main-tasks.html`) & Nhóm Công Việc (`task-groups.html`):**
    - Các công việc được tạo trong `main-tasks.html` sẽ được gom lại thành các nhóm trong `task-groups.html`. Đây là bước định nghĩa "ngân hàng công việc".

2.  **Công Việc Chính (`main-tasks.html`) -> Lịch Hàng Ngày (`index.html`):**
    - Dữ liệu từ `MOCK_MAIN_TASKS` (giả lập cho `main-tasks.html`) được sử dụng để hiển thị thông tin chi tiết (tên, mã) của các thẻ công việc trên lưới lịch.
    - Khi người dùng **Thêm Lịch Làm Việc Mới** trên `index.html`, họ nhập vào các "Mã Công Việc". Hệ thống sẽ dùng các mã này để tra cứu trong `MOCK_MAIN_TASKS` và tạo ra các đối tượng công việc tương ứng để thêm vào lịch.

3.  **Nhân Viên (`staff.html`) -> Lịch Hàng Ngày (`index.html`) & Lịch Hàng Tháng (`month.html`):**
    - Danh sách nhân viên từ `staff.html` là nguồn để chọn và phân công lịch trên cả hai trang lịch. Trong `index.html`, thông tin nhân viên được hiển thị ở mỗi hàng. Trong `month.html`, tên nhân viên được hiển thị trong các ô ngày.

4.  **Lịch Hàng Ngày (`index.html`) <-> Lịch Hàng Tháng (`month.html`):**
    - `index.html` là nơi thực hiện việc phân công chi tiết (công việc theo từng giờ).
    - `month.html` tổng hợp lại kết quả phân công đó dưới dạng ca làm việc tổng quan. Dữ liệu trên `month.html` có thể được coi là một "summary" của dữ liệu chi tiết từ `index.html`.

**Luồng làm việc của người quản lý (dự kiến):**

`Quản lý Nhóm/Công việc` -> `Quản lý Nhân viên` -> `Lập Lịch Hàng Ngày` (phân công chi tiết) -> `Xem Lịch Hàng Tháng` (để có cái nhìn tổng quan).